{% extends "base.html" %}

{% block title %}{{ empresa.nome_empresa }} - Detalhes Completos{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('listar_empresas') }}">Empresas</a></li>
<li class="breadcrumb-item active">{{ empresa.nome_empresa }}</li>
{% endblock %}

{% block content %}
{% macro render_badge_list(items, badge_class, icon_class, placeholder_html) %}
    {% if items %}
        <div class="d-flex flex-wrap gap-2">
            {% set processed_items = [] %}
            {% if items is iterable and items is not string %}
                {% set processed_items = items %}
            {% elif items is string and items.strip() %}
                {% set temp_str = items.strip() %}
                {% if temp_str.startswith('[') and temp_str.endswith(']') %}
                    {% set temp_str = temp_str[1:-1]|replace('"', '')|replace("'", '') %}
                {% endif %}
                {% set processed_items = temp_str.split(',') %}
            {% elif items %}
                {% set processed_items = [items|string] %}
            {% endif %}

            {% for item in processed_items if item and item.strip() %}
                <span class="badge {{ badge_class }} fs-6 px-3 py-2">
                    <i class="bi {{ icon_class }} me-1"></i>{{ item.strip() }}
                </span>
            {% endfor %}
        </div>
    {% else %}
        {{ placeholder_html|safe }}
    {% endif %}
{% endmacro %}


<div class="container-fluid" style="max-width: 1400px;">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-primary mb-2">
                        <i class="bi bi-building-gear me-3"></i>{{ empresa.nome_empresa }}
                    </h1>
                    <p class="text-muted mb-0">Visualização completa de todos os dados cadastrados</p>
                </div>
                <div class="text-end">
                    <div class="badge bg-primary-subtle text-primary px-3 py-2 mb-2">
                        Código: {{ empresa.codigo_empresa or 'N/A' }}
                    </div>
                    <div class="d-block">
                        <a href="{{ url_for('editar_empresa', id=empresa.id) }}" class="btn btn-primary btn-sm">
                            <i class="bi bi-pencil me-1"></i>Editar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body py-3">
                    <div class="d-flex justify-content-center flex-wrap gap-2">
                        <a href="#dados-empresa" class="btn btn-outline-primary btn-sm"><i class="bi bi-building me-1"></i>Dados da Empresa</a>
                        <a href="#fiscal" class="btn btn-outline-success btn-sm"><i class="bi bi-receipt me-1"></i>Fiscal</a>
                        <a href="#contabil" class="btn btn-outline-info btn-sm"><i class="bi bi-calculator me-1"></i>Contábil</a>
                        <a href="#pessoal" class="btn btn-outline-warning btn-sm"><i class="bi bi-people me-1"></i>Pessoal</a>
                        <a href="#administrativo" class="btn btn-outline-dark btn-sm"><i class="bi bi-gear me-1"></i>Administrativo</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-lg mb-5" id="dados-empresa">
        <div class="card-header bg-primary text-white py-3">
            <h3 class="mb-0 fw-semibold"><i class="bi bi-building me-2"></i>Dados da Empresa</h3>
        </div>
        <div class="card-body p-4">
            <div class="row g-4">
                 <div class="col-lg-4 col-md-6">
                    <div class="info-group">
                        <h6 class="text-primary mb-3 border-bottom pb-2"><i class="bi bi-card-text me-2"></i>Identificação</h6>
                        <div class="info-item">
                            <label class="info-label">Código da Empresa</label>
                            <div class="info-value"><span class="badge bg-primary-subtle text-primary fs-6">{{ empresa.codigo_empresa or 'Não informado' }}</span></div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Nome da Empresa</label>
                            <div class="info-value fw-semibold text-primary">{{ empresa.nome_empresa or 'Não informado' }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">CNPJ</label>
                            <div class="info-value font-monospace clickable-copy">
                                {% if empresa.cnpj %}{% set cnpj = empresa.cnpj|string %}{% if cnpj|length == 14 %}{{ cnpj[:2] }}.{{ cnpj[2:5] }}.{{ cnpj[5:8] }}/{{ cnpj[8:12] }}-{{ cnpj[12:] }}{% else %}{{ empresa.cnpj }}{% endif %}{% else %}<span class="text-muted">Não informado</span>{% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Data de Abertura</label>
                            <div class="info-value">
                                {% if empresa.data_abertura %}<span class="badge bg-info-subtle text-info">{{ empresa.data_abertura.strftime('%d/%m/%Y') }}</span>{% else %}<span class="text-muted">Não informada</span>{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="col-lg-4 col-md-6">
                    <div class="info-group">
                        <h6 class="text-primary mb-3 border-bottom pb-2"><i class="bi bi-briefcase me-2"></i>Informações Empresariais</h6>
                        <div class="info-item">
                            <label class="info-label">Sócio Administrador</label>
                            <div class="info-value">{% if empresa.socio_administrador %}<i class="bi bi-person-check me-2 text-primary"></i>{{ empresa.socio_administrador }}{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Atividade Principal</label>
                            <div class="info-value">{% if empresa.atividade_principal %}</i>{{ empresa.atividade_principal }}{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Tributação</label>
                            <div class="info-value">{% if empresa.tributacao %}<span class="badge bg-success-subtle text-success fs-6"><i class="bi bi-calculator me-1"></i>{{ empresa.tributacao }}</span>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Regime de Lançamento</label>
                            <div class="info-value">{% if empresa.regime_lancamento %}<span class="badge bg-warning-subtle text-warning fs-6"><i class="bi bi-journal-text me-1"></i>{{ empresa.regime_lancamento.value }}</span>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12">
                    <div class="info-group">
                        <h6 class="text-primary mb-3 border-bottom pb-2"><i class="bi bi-pc-display me-2"></i>Sistemas e Tecnologia</h6>
                        <div class="info-item">
                            <label class="info-label">Sistema Utilizado</label>
                            <div class="info-value">{% if empresa.sistema_utilizado %}<div class="d-flex align-items-center"><i class="bi bi-laptop me-2 text-primary"></i><span class="badge bg-primary-subtle text-primary">{{ empresa.sistema_utilizado }}</span></div>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Sistemas/Consultorias</label>
                            <div class="info-value">
                                {% set placeholder_sistemas %}<span class="text-muted">Nenhum sistema adicional</span>{% endset %}
                                {{ render_badge_list(empresa.sistemas_consultorias, 'badge bg-secondary', 'bi-tools', placeholder_sistemas) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="fiscal">
    {% if fiscal %}
        <div class="card shadow-lg mb-5">
            <div class="card-header bg-success text-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0 fw-semibold"><i class="bi bi-receipt me-2"></i>Departamento Fiscal</h3>
                    {% if fiscal.updated_at %}<small class="opacity-75"><i class="bi bi-clock me-1"></i>Atualizado: {{ fiscal.updated_at.strftime('%d/%m/%Y às %H:%M') }}</small>{% endif %}
                </div>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    <div class="col-lg-6 col-md-12">
                        <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Informações Básicas</h6>
                            <div class="info-item">
                                <label class="info-label">Responsável</label>
                                <div class="info-value">{% if fiscal.responsavel %}<i class="bi bi-person-badge me-2 text-success"></i><span class="fw-semibold">{{ fiscal.responsavel }}</span>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Descrição do Departamento</label>
                                <div class="info-value">{% if fiscal.descricao %}<div class="border rounded p-2 bg-light"><i class="bi bi-file-text me-2 text-success"></i>{{ fiscal.descricao }}</div>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Forma de Movimento</label>
                                <div class="info-value">{% if fiscal.forma_movimento %}<span class="badge bg-success-subtle text-success fs-6"><i class="bi bi-arrow-left-right me-1"></i>{{ fiscal.forma_movimento }}</span>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-building me-2"></i>Acesso à Prefeitura</h6>
                            <div class="info-item">
                                <label class="info-label">Link da Prefeitura</label>
                                <div class="info-value">{% if fiscal.link_prefeitura and fiscal.link_prefeitura.strip() %}<a href="{{ fiscal.link_prefeitura }}" target="_blank" class="text-decoration-none"><i class="bi bi-link-45deg me-1 text-success"></i><span class="text-primary">{{ fiscal.link_prefeitura[:60] }}{% if fiscal.link_prefeitura|length > 60 %}...{% endif %}</span><i class="bi bi-box-arrow-up-right ms-1"></i></a>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Usuário da Prefeitura</label>
                                <div class="info-value">{% if fiscal.usuario_prefeitura %}<div class="font-monospace clickable-copy border rounded p-2 bg-light"><i class="bi bi-person me-2 text-success"></i>{{ fiscal.usuario_prefeitura }}<i class="bi bi-clipboard ms-2 text-muted" title="Clique para copiar"></i></div>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Senha da Prefeitura</label>
                                <div class="info-value centered">{% if fiscal.senha_prefeitura and fiscal.senha_prefeitura.strip() %}<span class="password-field" data-password="{{ fiscal.senha_prefeitura }}"><div class="d-flex align-items-center border rounded p-2 bg-light"><i class="bi bi-key me-2 text-success"></i><span class="password-hidden font-monospace">••••••••</span><button type="button" class="btn btn-sm btn-outline-success ms-2 toggle-password"><i class="bi bi-eye"></i></button></div></span>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mt-2">
                    <div class="col-12">
                        <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-download me-2"></i>Formas de Importação</h6>
                            <div class="info-value">
                                {% set placeholder_importacao %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-inbox fs-2 mb-2"></i><p class="mb-0">Nenhuma forma de importação configurada</p></div>{% endset %}
                                {{ render_badge_list(fiscal.formas_importacao, 'bg-primary-subtle text-primary', 'bi-check-circle', placeholder_importacao) }}
                            </div>
                        </div>
                        <div class="info-group mt-4">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-person-lines-fill me-2"></i>Contato</h6>
                            <div class="info-value">
                                {% if fiscal.contato_nome %}
                                    <span class="fw-semibold">{{ fiscal.contato_nome }}</span>
                                    {% if fiscal.contato_meios %}
                                        <div class="text-muted small">{{ fiscal.contato_meios }}</div>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Não informado</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-4 mt-2">
                    <div class="col-md-6">
                         <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-cloud-upload me-2"></i>Envio Digital</h6>
                            <div class="info-value">
                                {% set placeholder_env_digital %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-cloud-slash fs-3 mb-2"></i><p class="mb-0 small">Não configurado</p></div>{% endset %}
                                {{ render_badge_list(fiscal.envio_digital, 'bg-success-subtle text-success', 'bi-cloud-check', placeholder_env_digital) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                         <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-layers me-2"></i>Envio Digital/Físico</h6>
                             <div class="info-value">
                                {% set placeholder_env_fisico %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-inbox fs-3 mb-2"></i><p class="mb-0 small">Não configurado</p></div>{% endset %}
                                {{ render_badge_list(fiscal.envio_digital_fisico, 'bg-warning-subtle text-warning', 'bi-layers', placeholder_env_fisico) }}
                            </div>
                        </div>
                    </div>
                </div>

                 {% if fiscal.particularidades_texto and fiscal.particularidades_texto.strip() %}
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="info-group">
                            <h6 class="text-success mb-3 border-bottom pb-2"><i class="bi bi-pencil-square me-2"></i>Particularidades</h6>
                            <div class="border rounded p-4 bg-white editor-content">{{ fiscal.particularidades_texto|safe }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="card shadow-lg mb-5 border-success">
            <div class="card-header bg-success text-white py-3"><h3 class="mb-0 fw-semibold"><i class="bi bi-receipt me-2"></i>Departamento Fiscal</h3></div>
            <div class="card-body p-4 text-center"><div class="py-5"><i class="bi bi-exclamation-triangle-fill fs-1 text-success mb-3"></i><h5 class="text-muted">Departamento Fiscal não configurado</h5><p class="text-muted mb-4">Este departamento ainda não foi configurado.</p><a href="{{ url_for('editar_empresa', id=empresa.id) }}#fiscal" class="btn btn-success"><i class="bi bi-plus-circle me-2"></i>Configurar</a></div></div>
        </div>
    {% endif %}
    </div>

    <div id="contabil">
    {% if contabil %}
        <div class="card shadow-lg mb-5">
            <div class="card-header bg-info text-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0 fw-semibold"><i class="bi bi-calculator me-2"></i>Departamento Contábil</h3>
                    {% if contabil.updated_at %}<small class="opacity-75"><i class="bi bi-clock me-1"></i>Atualizado: {{ contabil.updated_at.strftime('%d/%m/%Y às %H:%M') }}</small>{% endif %}
                </div>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    <div class="col-lg-6 col-md-12">
                        <div class="info-group">
                            <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Informações Básicas</h6>
                            <div class="info-item">
                                <label class="info-label">Responsável</label>
                                <div class="info-value">{% if contabil.responsavel %}<i class="bi bi-person-badge me-2 text-info"></i><span class="fw-semibold">{{ contabil.responsavel }}</span>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Descrição</label>
                                <div class="info-value">{% if contabil.descricao %}<div class="border rounded p-2 bg-light"><i class="bi bi-file-text me-2 text-info"></i>{{ contabil.descricao }}</div>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Método de Importação</label>
                                <div class="info-value">{% if contabil.metodo_importacao %}<span class="badge bg-info-subtle text-info fs-6"><i class="bi bi-download me-1"></i>{{ contabil.metodo_importacao }}</span>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                            </div>
                             <div class="info-item">
                                <label class="info-label">Forma de Movimento</label>
                                <div class="info-value">{% if contabil.forma_movimento %}<span class="badge bg-info-subtle text-info fs-6"><i class="bi bi-arrow-left-right me-1"></i>{{ contabil.forma_movimento }}</span>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="info-group">
                            <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-chat-square-text me-2"></i>Observações</h6>
                             <div class="info-item">
                                <label class="info-label">Observação de Movimento</label>
                                <div class="info-value">{% if contabil.observacao_movimento %}<div class="border rounded p-3 bg-light"><i class="bi bi-sticky me-2 text-info"></i>{{ contabil.observacao_movimento }}</div>{% else %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-chat-square fs-3 mb-2"></i><p class="mb-0">Nenhuma observação</p></div>{% endif %}</div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Observação de Relatórios</label>
                                <div class="info-value">{% if contabil.observacao_controle_relatorios %}<div class="border rounded p-3 bg-light"><i class="bi bi-file-earmark-text me-2 text-info"></i>{{ contabil.observacao_controle_relatorios }}</div>{% else %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-file-earmark fs-3 mb-2"></i><p class="mb-0">Nenhuma observação</p></div>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mt-2">
                    <div class="col-md-6">
                        <div class="info-group">
                            <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-cloud-upload me-2"></i>Envio Digital</h6>
                            <div class="info-value">
                                {% set placeholder_cont_digital %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-cloud-slash fs-3 mb-2"></i><p class="mb-0 small">Não configurado</p></div>{% endset %}
                                {{ render_badge_list(contabil.envio_digital, 'bg-success-subtle text-success', 'bi-cloud-check', placeholder_cont_digital) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-group">
                            <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-layers me-2"></i>Envio Digital/Físico</h6>
                            <div class="info-value">
                                {% set placeholder_cont_fisico %}<div class="text-center text-muted py-3 border rounded bg-light"><i class="bi bi-inbox fs-3 mb-2"></i><p class="mb-0 small">Não configurado</p></div>{% endset %}
                                {{ render_badge_list(contabil.envio_digital_fisico, 'bg-warning-subtle text-warning', 'bi-layers', placeholder_cont_fisico) }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-4 mt-2">
                    <div class="col-12">
                        <div class="info-group">
                             <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-file-earmark-text me-2"></i>Controle de Relatórios</h6>
                             <div class="info-value">
                                {% set placeholder_relatorios %}<div class="text-center text-muted py-4 border rounded bg-light"><i class="bi bi-file-earmark-x fs-2 mb-2"></i><p class="mb-0">Nenhum controle de relatório configurado</p></div>{% endset %}
                                {{ render_badge_list(contabil.controle_relatorios, 'bg-primary-subtle text-primary', 'bi-check-square', placeholder_relatorios) }}
                            </div>
                        </div>
                    </div>
                </div>

                {% if contabil.particularidades_texto and contabil.particularidades_texto.strip() %}
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="info-group">
                            <h6 class="text-info mb-3 border-bottom pb-2"><i class="bi bi-pencil-square me-2"></i>Particularidades</h6>
                            <div class="border rounded p-4 bg-white editor-content">{{ contabil.particularidades_texto|safe }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="card shadow-lg mb-5 border-info">
            <div class="card-header bg-info text-white py-3"><h3 class="mb-0 fw-semibold"><i class="bi bi-calculator me-2"></i>Departamento Contábil</h3></div>
            <div class="card-body p-4 text-center"><div class="py-5"><i class="bi bi-exclamation-triangle-fill fs-1 text-info mb-3"></i><h5 class="text-muted">Departamento Contábil não configurado</h5><p class="text-muted mb-4">Este departamento ainda não foi configurado.</p><a href="{{ url_for('editar_empresa', id=empresa.id) }}#contabil" class="btn btn-info"><i class="bi bi-plus-circle me-2"></i>Configurar</a></div></div>
        </div>
    {% endif %}
    </div>

    <div id="pessoal">
        {% if pessoal %}
            <div class="card shadow-lg mb-5">
                <div class="card-header text-white py-3" style="background-color: #f39c12;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0 fw-semibold"><i class="bi bi-people me-2"></i>Departamento Pessoal</h3>
                        {% if pessoal.updated_at %}<small class="opacity-75"><i class="bi bi-clock me-1"></i>Atualizado: {{ pessoal.updated_at.strftime('%d/%m/%Y às %H:%M') }}</small>{% endif %}
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        <div class="col-lg-6 col-md-12">
                            <div class="info-group">
                                <h6 class="text-warning mb-3 border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Informações Básicas</h6>
                                <div class="info-item">
                                    <label class="info-label">Responsável</label>
                                    <div class="info-value">{% if pessoal.responsavel %}<i class="bi bi-person-badge me-2 text-warning"></i><span class="fw-semibold">{{ pessoal.responsavel }}</span>{% else %}<span class="text-muted">Não informado</span>{% endif %}</div>
                                </div>
                                <div class="info-item">
                                    <label class="info-label">Descrição</label>
                                    <div class="info-value">{% if pessoal.descricao %}<div class="border rounded p-2 bg-light"><i class="bi bi-file-text me-2 text-warning"></i>{{ pessoal.descricao }}</div>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                                </div>
                                <div class="info-item">
                                    <label class="info-label">Data de Envio</label>
                                    <div class="info-value">{% if pessoal.data_envio %}<span class="badge bg-warning-subtle text-warning fs-6"><i class="bi bi-calendar-event me-1"></i>{{ pessoal.data_envio }}</span>{% else %}<span class="text-muted">Não informada</span>{% endif %}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12">
                            <div class="info-group">
                                <h6 class="text-warning mb-3 border-bottom pb-2"><i class="bi bi-gear me-2"></i>Controles e Sistemas</h6>
                                <div class="row">
                                    <div class="col-md-4 text-center info-item">
                                        <label class="info-label">Registro de Funcionários</label>
                                        <div class="info-value mt-2">
                                            {% if pessoal.registro_funcionarios %}
                                                <span class="badge bg-warning-subtle text-warning fs-6 px-3 py-2"><i class="bi bi-person-lines-fill me-2"></i>{{ pessoal.registro_funcionarios }}</span>
                                            {% else %}
                                                <span class="badge bg-light text-muted fs-6 px-3 py-2"><i class="bi bi-x-circle me-2"></i>Não tem</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center info-item">
                                        <label class="info-label">Ponto Eletrônico</label>
                                        <div class="info-value mt-2">
                                            {% if pessoal.ponto_eletronico %}
                                                <span class="badge bg-info-subtle text-info fs-6 px-3 py-2"><i class="bi bi-clock me-2"></i>{{ pessoal.ponto_eletronico }}</span>
                                            {% else %}
                                                <span class="badge bg-light text-muted fs-6 px-3 py-2"><i class="bi bi-x-circle me-2"></i>Não informado</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center info-item">
                                        <label class="info-label">Sistema de Pagamento</label>
                                        <div class="info-value mt-2">
                                            {% if pessoal.pagamento_funcionario %}
                                                <span class="badge bg-success-subtle text-success fs-6 px-3 py-2"><i class="bi bi-currency-dollar me-2"></i>{{ pessoal.pagamento_funcionario }}</span>
                                            {% else %}
                                                <span class="badge bg-light text-muted fs-6 px-3 py-2"><i class="bi bi-x-circle me-2"></i>Não informado</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
    
                    {% if pessoal.particularidades_texto and pessoal.particularidades_texto.strip() %}
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="info-group">
                                <h6 class="text-warning mb-3 border-bottom pb-2"><i class="bi bi-pencil-square me-2"></i>Particularidades</h6>
                                <div class="border rounded p-4 bg-white editor-content">{{ pessoal.particularidades_texto|safe }}</div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="card shadow-lg mb-5 border-warning">
                <div class="card-header text-white py-3" style="background-color: #f39c12;"><h3 class="mb-0 fw-semibold"><i class="bi bi-people me-2"></i>Departamento Pessoal</h3></div>
                <div class="card-body p-4 text-center"><div class="py-5"><i class="bi bi-exclamation-triangle-fill fs-1 text-warning mb-3"></i><h5 class="text-muted">Departamento Pessoal não configurado</h5><p class="text-muted mb-4">Este departamento ainda não foi configurado.</p><a href="{{ url_for('editar_empresa', id=empresa.id) }}#pessoal" class="btn btn-warning"><i class="bi bi-plus-circle me-2"></i>Configurar</a></div></div>
            </div>
        {% endif %}
        </div>

    <div id="administrativo">
    {% if administrativo %}
        <div class="card shadow-lg mb-5">
            <div class="card-header bg-dark text-white py-3">
                 <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0 fw-semibold"><i class="bi bi-gear me-2"></i>Departamento Administrativo</h3>
                    {% if administrativo.updated_at %}<small class="opacity-75"><i class="bi bi-clock me-1"></i>Atualizado: {{ administrativo.updated_at.strftime('%d/%m/%Y às %H:%M') }}</small>{% endif %}
                </div>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    <div class="col-lg-6 col-md-6">
                        <div class="info-group">
                            <h6 class="text-dark mb-3 border-bottom pb-2"><i class="bi bi-person-gear me-2"></i>Responsável</h6>
                            <div class="info-item">
                                <label class="info-label">Responsável do Departamento</label>
                                <div class="info-value">{% if administrativo.responsavel %}<div class="d-flex align-items-center"><i class="bi bi-person-badge fs-4 me-3 text-dark"></i><div><span class="fw-semibold fs-5">{{ administrativo.responsavel }}</span><div class="text-muted small">Responsável Administrativo</div></div></div>{% else %}<div class="text-center text-muted py-4 border rounded bg-light"><i class="bi bi-person-x fs-2 mb-2"></i><p class="mb-0">Responsável não informado</p></div>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="info-group">
                            <h6 class="text-dark mb-3 border-bottom pb-2"><i class="bi bi-file-text me-2"></i>Descrição</h6>
                            <div class="info-item">
                                <label class="info-label">Descrição do Departamento</label>
                                <div class="info-value">{% if administrativo.descricao %}<div class="border rounded p-3 bg-light"><i class="bi bi-info-circle me-2 text-dark"></i><span>{{ administrativo.descricao }}</span></div>{% else %}<div class="text-center text-muted py-4 border rounded bg-light"><i class="bi bi-file-text fs-2 mb-2"></i><p class="mb-0">Descrição não informada</p></div>{% endif %}</div>
                            </div>
                        </div>
                    </div>
                </div>

                {% if administrativo.particularidades_texto and administrativo.particularidades_texto.strip() %}
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="info-group">
                            <h6 class="text-dark mb-3 border-bottom pb-2"><i class="bi bi-pencil-square me-2"></i>Particularidades</h6>
                            <div class="border rounded p-4 bg-white editor-content">{{ administrativo.particularidades_texto|safe }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="card shadow-lg mb-5 border-dark">
            <div class="card-header bg-dark text-white py-3"><h3 class="mb-0 fw-semibold"><i class="bi bi-gear me-2"></i>Departamento Administrativo</h3></div>
            <div class="card-body p-4 text-center"><div class="py-5"><i class="bi bi-exclamation-triangle-fill fs-1 text-dark mb-3"></i><h5 class="text-muted">Departamento Administrativo não configurado</h5><p class="text-muted mb-4">Este departamento ainda não foi configurado.</p><a href="{{ url_for('editar_empresa', id=empresa.id) }}#administrativo" class="btn btn-dark"><i class="bi bi-plus-circle me-2"></i>Configurar</a></div></div>
        </div>
    {% endif %}
    </div>

    <div class="row my-5">
        <div class="col-12">
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="{{ url_for('listar_empresas') }}" class="btn btn-outline-secondary px-4"><i class="bi bi-arrow-left me-2"></i>Voltar para Lista</a>
                <a href="{{ url_for('editar_empresa', id=empresa.id) }}" class="btn btn-primary px-4"><i class="bi bi-pencil me-2"></i>Editar Empresa</a>
                <a href="{{ url_for('editar_empresa', id=empresa.id) }}#fiscal" class="btn btn-outline-info px-4"><i class="bi bi-diagram-3 me-2"></i>Gerenciar Departamentos</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Smooth scroll para navegação com offset para o cabeçalho
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const offset = 80; 
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - offset;

                window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
            }
        });
    });

    // Toggle para mostrar/ocultar senhas
    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', function() {
            const passwordField = this.closest('.password-field');
            const hiddenSpan = passwordField.querySelector('.password-hidden');
            const password = passwordField.getAttribute('data-password');
            const icon = this.querySelector('i');
            
            if (hiddenSpan.textContent === '••••••••') {
                hiddenSpan.textContent = password;
                icon.classList.replace('bi-eye', 'bi-eye-slash');
                this.setAttribute('title', 'Ocultar senha');
            } else {
                hiddenSpan.textContent = '••••••••';
                icon.classList.replace('bi-eye-slash', 'bi-eye');
                this.setAttribute('title', 'Mostrar senha');
            }
        });
    });

    // Funcionalidade de copiar para a área de transferência
    document.querySelectorAll('.clickable-copy').forEach(element => {
        const textToCopy = element.textContent.trim();
        if (textToCopy && textToCopy !== '-' && textToCopy !== 'Não informado') {
            element.addEventListener('click', function() {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const icon = this.querySelector('.bi-clipboard');
                    if (icon) icon.classList.replace('bi-clipboard', 'bi-clipboard-check-fill');
                    
                    setTimeout(() => {
                        if (icon) icon.classList.replace('bi-clipboard-check-fill', 'bi-clipboard');
                    }, 1500);
                }).catch(err => console.error('Erro ao copiar: ', err));
            });
        }
    });

    // Highlighting da seção ativa durante scroll
    const observerOptions = { root: null, rootMargin: '-20% 0px -70% 0px', threshold: 0.1 };
    const observer = new IntersectionObserver((entries) => {
        let lastIntersectingId = null;
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                 lastIntersectingId = entry.target.getAttribute('id');
            }
        });

        if (lastIntersectingId) {
            document.querySelectorAll('.card-body .btn-sm').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`a[href="#${lastIntersectingId}"]`);
            if (activeLink) activeLink.classList.add('active');
        }
    }, observerOptions);

    document.querySelectorAll('div[id]').forEach(section => {
        if (section.id) observer.observe(section);
    });

    // Otimização para impressão
    window.addEventListener('beforeprint', () => {
        document.querySelectorAll('.password-field .password-hidden').forEach(field => {
            if (field.textContent === '••••••••') {
                const password = field.closest('.password-field').getAttribute('data-password');
                if (password) field.textContent = password;
            }
        });
    });

    window.addEventListener('afterprint', () => {
        document.querySelectorAll('.password-field .password-hidden').forEach(field => {
             const password = field.closest('.password-field').getAttribute('data-password');
             if (password) field.textContent = '••••••••';
        });
    });

    // Função de exportar para PDF (usa a funcionalidade de impressão do navegador)
    window.exportToPDF = function() { window.print(); };

    // Inicialização de Tooltips do Bootstrap, se disponível
    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
        document.querySelectorAll('[title]').forEach(element => new bootstrap.Tooltip(element));
    }
});
</script>
{% endblock %}
